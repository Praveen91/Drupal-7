Daily Tips and Trick for Drupal
-------------------------------
Add Content to a Region Programmatically
Programmatically adding content to a region. I did this in hook_page_preprocess_page().
$variables['page']['rows_abovesidebar'][]['#markup'] = '<p>My html...</p>';



/**
 * Implements hook_token_info().
 */
function campusmate_views_token_info() {

  // Add tokens.
  $view['subject_name'] = array(
    'name' => t('Subject Details page title'),
    'description' => t('Page title for Subject Details page'),
  );

   $view['tutor_name'] = array(
    'name' => t('Tutor Name'),
    'description' => t('Tutor name for page title'),
  );

  return array(
    'tokens' => array(
      'view' => $view,
    ),
  );
}

/**
 * Implements hook_tokens().
 */
function campusmate_views_tokens($type, $tokens, array $data = array(), array $options = array()) {

  $replacements = array();

 if ($type == 'view') {

    foreach ($tokens as $name => $original) {
      switch ($name) {
        case 'subject_name':
       if ( arg(0) == 'subjectdetail' && is_numeric(arg(1))) {
          $tid = arg(1);
          $term = taxonomy_term_load($tid);
          $sub_term_name = $term->name;
          $replacements[$original] = $sub_term_name;
        }
          break;
          case 'tutor_name':
          if ( arg(0) == 'tutor-details' && is_numeric(arg(1))) {
            $tutor_id = arg(1);
            $tutor_profile = profile2_by_uid_load($tutor_id, 'tutor_profile');
            $profile_wrapper = entity_metadata_wrapper('profile2', $tutor_profile);
            $raw_collection = $profile_wrapper->field_personal_information->value();
            $fname = $raw_collection->field_tutor_first_name['und'][0]['value'];
            $lname = $raw_collection->field_tutor_last_name['und'][0]['value'];
            $lname = substr($lname,0,1);
            $tutor_short_name  = $fname .' '. $lname . '.';
            $replacements[$original] = $tutor_short_name;
          }
            break;
      }
    }
  }

  // Return the replacements.
  return $replacements;
}



Custom add to cart using ajax call
----------------------------------

HTML code : with classroom_id and product_id
<div name="126" rel="100" class="card-time go-to-checkout">0:00:00h</div>

Js code : onclick we get values of classroom_id and product_id.
          using ajax call we pass this hook_menu to callback fuction
    /**
     * Add Time event.
     */
    Drupal.behaviors.addTime = {
        attach: function (context) {
            jQuery('.go-to-checkout', context).click(function () {
                // Call ajax.
                var class_id = jQuery(this).attr("name");
                var pack_id = jQuery(this).attr("rel");

                jQuery.ajax({
                    url: Drupal.settings.basePath + 'add_to_checkout',
                    type: 'POST',
                    data: "pack_id=" + pack_id +"&class_id="+class_id,
                    success: function (result) {
                        window.location = Drupal.settings.basePath + 'checkout';
                    },
                });
            });
        }
    };


PHP and Drupal
--------------
/**
 * Implements hook_menu().
 */
function mymodule_menu() {
$items['add_to_checkout'] = [
    'title' => 'Add to checkout',
    'page callback' => 'campus_add_to_checkout',
    'access arguments' => ['access content'],
    'type' => MNEU_CALLBACK
  ];
  return $items;
}



/**
 * Callback function campus_add_to_checkout().
 */
function campus_add_to_checkout(){
    
    global $user;
    
    $classroom_id = $_POST['class_id'];
    $product_id = $_POST['pa
/**
 * Implements hook_menu().
 */
function campusmate_views_menu() {

  $items['tutor/subject/field_select_subjects'] = array(
   'title' => 'Autocomplete deluxe taxonomy',
    'page callback' => 'autocomplete_tutor_subject_callback',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,

  );

  return $items;
}
ck_id'];
    $quantity   = 1;
    if ($product = commerce_product_load($product_id)) {
        
    $line_item = commerce_product_line_item_new($product, $quantity);
    $line_item->field_classroom_id[LANGUAGE_NONE][0]['value'] = $classroom_id;
    drupal_alter('commerce_product_calculate_sell_price_line_item', $line_item);
    
    rules_invoke_event('commerce_product_calculate_sell_price', $line_item);
    
    commerce_marketplace_cart_product_add($user->uid, $line_item, TRUE);
    
    #drupal_goto('checkout');
  }
  else {
    drupal_set_message(t('Error occured during adding product to cart! Try to use Add to cart button.'));
  }
    echo "success";
}


Cuastom Callback fuction for autocomplete_deluxe 
------------------------------------------------

/**
 * Implements hook_menu().
 */
function campusmate_views_menu() {

  $items['tutor/subject/field_select_subjects'] = array(
   'title' => 'Autocomplete deluxe taxonomy',
    'page callback' => 'autocomplete_tutor_subject_callback',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,

  );

  return $items;
}



/**
 * Implements hook_form_alter().
 * @see http://drupal.org/node/1079826 for more information on this code.
 */
function campusmate_views_form_alter(&$form, $form_state, $form_id) {

if ($form_id == 'views_exposed_form' && $form_state['view']->name == 'tutor_listing') {

    $form['field_select_subjects_tid'] = array(
    '#type' => 'autocomplete_deluxe',
    '#autocomplete_deluxe_path' => url('tutor/subject/field_select_subjects'),
    '#multiple' => TRUE,
    '#autocomplete_min_length' => 0,
    '#autocomplete_multiple_delimiter' => ',',
    );
    //kpr($form);
   }
}

function autocomplete_tutor_subject_callback($string = "") {

  $query = db_select('taxonomy_term_data', 'ttd');
  $query->distinct();
  $query->fields('ttd', array('tid', 'name'));
  $query->join('field_data_field_select_subjects', 'sub_tid', 'ttd.tid = sub_tid.field_select_subjects_tid');
  $query->condition('sub_tid.bundle', 'tutors_packs');
  //$query->condition('ttd.name', db_like($string) . '%', 'LIKE');
  $query->range(0, 10);
  $result = $query->execute()->fetchAll();
    foreach ($result as $subject) {
      $matches[$subject->name . ""] = check_plain($subject->name);
    }
    drupal_json_output($matches);
}




